<%-include("header")-%>

    <main class="main">
        <section class="mt-50 mb-50">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3">
                        <div class="widget-category mb-30">
                            <h5 class="section-title style-1 mb-30 wow fadeIn animated">Category</h5>
                            <ul class="categories">
                                <% categories.forEach(function(category) { %>
                                    <%if(category.blocked == false){%>
                                    <li><a href="/categoryOther?categoryId=<%= category._id %>">
                                            <%= category.name %>
                                        </a></li>
                                        <%}%>
                                    <% }); %>
                            </ul>
                        </div>
                        <div class="widget-category mb-30">
                            <h5 class="section-title style-1 mb-30 wow fadeIn animated">Sort by</h5>
                            <ul class="categories">
                                <li><a href="shop-grid-right.html">Popularity</a></li>
                                <li><a href="shop-grid-right.html">Average rating</a></li>
                                <li><a href="shop-grid-right.html">Price: Low to High</a></li>
                                <li><a href="shop-grid-right.html">Price: High to Low</a></li>
                            </ul>
                        </div>
                        <div class="widget-category mb-30">
                            <h5 class="section-title style-1 mb-30 wow fadeIn animated">Price Range</h5>
                            <ul class="categories">
                                <li><a href="shop-grid-right.html">$0-$200</a></li>
                                <li><a href="shop-grid-right.html">$200-$400</a></li>
                                <li><a href="shop-grid-right.html">$400-$600</a></li>
                                <li><a href="shop-grid-right.html">$600-$800</a></li>
                                <li><a href="shop-grid-right.html">800$+</a></li>
                            </ul>
                        </div>
                        <div class="banner-img wow fadeIn mb-45mb-lg-0 animated d-lg-block d-none">
                            <img src="assets/imgs/banner/banner-11.jpg" alt="">
                            <div class="banner-text">
                                <span>Women Zone</span>
                                <h4>Save 17% on <br>Office Dress</h4>
                                <a href="shop-grid-right.html">Shop Now <i class="fi-rs-arrow-right"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-9">
                        <div class="tab-header">
                            <ul class="nav nav-tabs" id="myTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="nav-tab-one" data-bs-toggle="tab"
                                        data-bs-target="#tab-one" type="button" role="tab" aria-controls="tab-one"
                                        aria-selected="true">Featured</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="nav-tab-two" data-bs-toggle="tab"
                                        data-bs-target="#tab-two" type="button" role="tab" aria-controls="tab-two"
                                        aria-selected="false">Popular</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="nav-tab-three" data-bs-toggle="tab"
                                        data-bs-target="#tab-three" type="button" role="tab" aria-controls="tab-three"
                                        aria-selected="false">New added</button>
                                </li>
                            </ul>
                        </div>

                        <div class="row product-grid-3">
                            <% product.forEach(function(product) { %>
                                <% if (product.blocked===false) { %>
                                    <% if (product.type==="Special" ) { %>
                                        <div class="col-lg-4 col-md-4 col-12 col-sm-6">
                                            <div class="product-cart-wrap mb-30">
                                                <div class="product-img-action-wrap">
                                                    <div class="product-img product-img-zoom">
                                                        <a href="/displayProduct?product_id=<%= product._id %>">
                                                            <img class="default-img"
                                                                src="/admin/productImages/<%= product.images[0] %>"
                                                                alt="<%= product.product_name %>">
                                                            <img class="hover-img"
                                                                src="/admin/productImages/<%= product.images[0] %>"
                                                                alt="<%= product.product_name %>">
                                                        </a>
                                                    </div>
                                                    <div class="product-action-1">
                                                        <!-- <a aria-label="Quick view" class="action-btn hover-up" data-bs-toggle="modal" data-bs-target="#quickViewModal"><i class="fi-rs-eye"></i></a> -->
                                                        <a aria-label="Add To Wishlist" class="action-btn hover-up"
                                                            href="#"
                                                            onclick="addToWishlist('<%= product._id %>')"><i
                                                                class="fi-rs-heart"></i></a>
                                                        <!-- <a aria-label="Compare" class="action-btn hover-up" href="shop-compare.html"><i class="fi-rs-shuffle"></i></a> -->
                                                    </div>
                                                    <% if (product.hot) { %>
                                                        <div
                                                            class="product-badges product-badges-position product-badges-mrg">
                                                            <span class="hot">Hot</span>
                                                        </div>
                                                        <% } %>
                                                </div>
                                                <div class="product-content-wrap">
                                                    <div class="product-category">
                                                        <a href="shop-grid-right.html">
                                                            <%= product.categoryId.name %>
                                                        </a>
                                                    </div>
                                                    <h2><a href="shop-product-right.html">
                                                            <%= product.product_name %>
                                                        </a></h2>
                                                    <div class="rating-result" title="<%= product.rating %>">
                                                        <span>
                                                            <span>
                                                                <%= product.rating %>
                                                            </span>
                                                        </span>
                                                    </div>
                                                    <div class="product-price">
                                                        <span>$<%= product.sales_price %> </span>
                                                        <span class="old-price">$<%= product.regular_price %></span>
                                                    </div>
                                                    <div class="product-action-1 show">
                                                        <% if (product.stock> 0) { %>
                                                            <!-- <a aria-label="Add To Cart" class="action-btn hover-up"
                                                                href="shop-cart.html"><i
                                                                    class="fi-rs-shopping-bag-add"></i></a> -->
                                                                    <a aria-label="Add To Cart" class="action-btn hover-up"
                                                                    href="#"
                                                                    onclick="addToCart('<%= product._id %>')"><i class="fi-rs-shopping-bag-add"></i></a>
                                                                 
                                                            <% } else { %>
                                                                <span class="out-of-stock">Out of Stock</span>
                                                                <% } %>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <% } %>
                                            <% } %>
                                                <% }); %>

                        </div>
                    </div>
                </div>
        </section>
    </main>

    <%-include("footer")-%>

    <script>
        function addToWishlist(productId) {
            $.ajax({
                url: '/wishlist',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ productId }),
                success: function (data) {
                    
                    console.log(data)
                    
                    if (data.status) {
                        
                       // window.location.href = '/wishlist'
                    } else {
                        
                        window.location.href = `/login?err=${true}&msg=Login first to add to Wishlist`
                    }
                },
                error: function (error) { 
                    window.location.href = `/login?err=${true}&msg=` + error.message
                }
            });
        }

        function addToCart(productId) {
            $.ajax({
                url: '/addToCart',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ productId }),
                success: function (data) {
                    
                    console.log(data)
                    
                    if (data.status) {
                        
                       // window.location.href = '/wishlist'
                    } else {
                        
                        window.location.href = `/login?err=${true}&msg=` + data.msg
                    }
                },
                error: function () { 
                    window.location.href = `/login?err=${true}&msg=Login first to add to cart`
                }
            });
        }

    </script>